EXTERN _ssn:DWORD               ; Extern keyword indicates that the symbol is defined in another module
EXTERN _retAddress:QWORD

.CODE  ; Start the code section

; Procedure for the generic syscall
genericSyscall PROC
    mov r10, rcx                                    ; Move the contents of rcx to r10. This is necessary because the syscall instruction in 64-bit Windows expects the parameters to be in the r10 and rdx registers.
    nop                                             ; Obfuscation
    and eax, eax                                    ; Obfuscation
    xor rax, rax                                    ; Obfuscation
    nop                                             ; Obfuscation
    mov eax, _ssn                                   ; Move the syscall number into the eax register.
    and rbx, rbx                                    ; Obfuscation
    mov rbx, _retAddress                            ; Prepare jmp to syscall
    jmp rbx                                         ; jmp to syscall
    xor rax, rax                                    ; Obfuscation
    and rcx, rcx                                    ; Obfuscation
genericSyscall ENDP                                  ; End of the procedure.

END  ; End of the module